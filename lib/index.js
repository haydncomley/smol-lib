var O=e=>typeof e=="object"?e?.hasOwnProperty("get")&&e?.hasOwnProperty("set"):!1,I=e=>typeof e=="object"?e?.hasOwnProperty("items"):!1,w=(e,...s)=>typeof e=="function"?w(e(...s)):e,L=e=>O(e)?w(e.get()):I(e)?e.items[0]?.tagName:e??"",M=e=>{let s=/.+ (.+)="/gm,n,t=[];for(;(n=s.exec(e))!==null;)n.index===s.lastIndex&&s.lastIndex++,n.forEach((f,C)=>{C===1&&t.push(f)});return t[t.length-1]};var E={},R=(e,s,n)=>{if(n.endsWith('="'))return"<!--A::-->";let t=O(s)?"V":I(s)?"B":"P",f=L(s),C=`${t}::${t==="V"?s.id:e}`;return t==="P"?f:`<!--${C}-->`},j=e=>{let s=document.createTreeWalker(e,NodeFilter.SHOW_COMMENT,{acceptNode:function(C){return NodeFilter.FILTER_ACCEPT}}),n=s.nextNode(),t=[];for(;n;)t.push(n),n=s.nextNode();return t},H=(e,s,n,...t)=>{let f=n.raw.length-1,C=[],T=[],k=n.raw.reduce((o,l,r)=>(l.endsWith('="')&&(T.push(t[r]),C.push(M(l))),o+l+(r<f?R(r,t[r],l):"")),""),u=document.createElement("div");u.innerHTML=k.trim();let g=[],c=0;(o=>{g=[...g,...o];let l=c,r=/([V|B])::(.*)/g;for(let a=c;a<o.length;a++){let x=g[a];if(c++,(x?.textContent?.trim()??"").match(r)){let h=x?.textContent?.trim().split("::")??[];if(h[0]==="V"){let m=()=>{let b=e[parseInt(h[1])];return typeof b=="function"?b():b},d=document.createTextNode(m());g[a]?.replaceWith(d),g[a]=d,s[parseInt(h[1])].push(()=>{g[a].textContent=m()})}else if(h[0]==="B"){let m=t.filter(d=>typeof d!="number"&&!["class","bind","echo"].includes(d.evalType))[a-1];if(m?.evalType==="if"){let d=()=>{if(w(m.eval?.get())){let v=m.evalRender(!0,1).items[l];g[a]?.replaceWith(v),g[a]=v}else{let v=document.createComment(`B::${h[1]}`);g[a]?.replaceWith(v),g[a]=v}};s[m.eval.id].push(()=>d()),d()}if(m?.evalType==="for"){let d=()=>{let b=g[a];b.arrayItems||(b.arrayItems=[]);let v=b.arrayItems,S=w(m.eval?.get()),B=typeof S=="number"?Array.from({length:S},(A,V)=>V):S;if(g[a].arrayItems||(g[a].arrayItems=[]),v.length>B.length)for(let A=v.length;A>B.length;A--)v.pop().remove();else if(v.length<B.length)for(let A=v.length;A<B.length;A++){let V=m.evalRender(B[A],A).items[l];(v[v.length-1]||b).after(V),v.push(V)}};s[m.eval.id].push(()=>d()),d()}}}}})([u.firstChild,...j(u.firstChild)]);let p=0;return C.forEach(o=>{g[0].parentElement.querySelectorAll(`*[${o}="<!--A::-->"]`).forEach(r=>{Array.from(r.attributes).forEach(a=>{if(a.value==="<!--A::-->"){let x=p++,y=T[x];if(y.evalType==="class"){let h=()=>{r.setAttribute(a.name,y.eval?.get())};h(),y.items.forEach(m=>{s[m.id]||(s[m.id]=[]),s[m.id].push(()=>h())})}else if(y.evalType==="echo"){let h=a.name,m=()=>{let d=typeof y?.eval=="object"?y?.eval?.get():y?.eval;typeof d=="boolean"?r.hasAttribute(h)?r.removeAttribute(h):r.setAttribute(h,""):r.setAttribute(h,d)};m(),typeof y?.eval=="object"&&s[y.eval.id].push(()=>m())}else if(y.evalType==="bind"){let h=a.name;r.removeAttribute(a.name);let m=()=>{let d=r;requestAnimationFrame(()=>{if(d.setBinding){let b=y.eval?.get();d.setBinding(h,b)}})};m(),s[y.eval.id].push(()=>m()),requestAnimationFrame(()=>{r.getBinding(h,d=>{e[y.eval.id]=d,s[y.eval.id].forEach(b=>b(d))})})}}})})}),{items:g}},P=(e,s,n)=>{if(customElements.get(e)){console.error(`Component with tag "${e}" has already been defined.`);return}customElements.define(e,class extends HTMLElement{componentArgStore;componentStoreBindings;constructor(){super();let t=this.attachShadow({mode:"closed"});if(typeof n=="string"||n?.styles!==void 0){let T=document.createElement("style");T.innerText=typeof n=="string"?n:n.styles,t.appendChild(T)}let{componentArgStore:f,componentStoreBindings:C}=_(t,s);this.componentArgStore=f,this.componentStoreBindings=C}setBinding=(t,f)=>{this.componentArgStore[t]&&this.componentArgStore[t].set(()=>f)};getBinding=(t,f)=>{this.componentArgStore[t]&&this.componentStoreBindings[this.componentArgStore[t].id].push(()=>{f(this.componentArgStore[t].get())})}})},_=(e,s)=>{let n=[],t=[],f={},C,T=0,k=0,u={},g=()=>{k++;let c=C({render:(i,...p)=>H(n,t,i,...p),_if:(i,p)=>({items:[],eval:i,evalRender:p,evalType:"if"}),_for:(i,p)=>({items:[],eval:i,evalRender:p,evalType:"for"}),_class:i=>{let p=u.use(()=>Object.values(i).map(o=>typeof o=="object"?o.get():o).map((o,l)=>o?Object.keys(i)[l]:"").filter(Boolean).join(" ").trim(),[]);return{items:Array.from(Object.values(i)),eval:p,evalType:"class"}},_bind:i=>({items:[],eval:i,evalType:"bind"}),_echo:i=>({items:[i],eval:i,evalType:"echo"})});u.element.appendChild(c.items[0]),u.on?.create&&u.on.create()};return u.on={},u.use=(c,i=[])=>{let p=++T;return p>n.length&&(n.push(L(c)),t.push([])),i.forEach(o=>{t[o.id].push(()=>{t[p-1].forEach(l=>l())})}),{id:p-1,get:()=>w(n[p-1]),set:o=>{let l=typeof o=="function"?o(n[p-1]):o,r=n[p-1];l!=r&&(n[p-1]=l,t[p-1].forEach(a=>a()))}}},u.arg=(c,{transformer:i,initial:p})=>{let o=e.host.getAttribute(c)?e.host.getAttribute(c):e.host.hasAttribute(c)?!0:p;f[c]||(f[c]=u.use(o));let l=f[c];return{id:l.id,get:(...r)=>i?i(w(n[l.id],...r)):w(n[l.id],...r),set:l.set}},u.store=(c,{transformer:i,initial:p})=>{E[c]||(E[c]={value:p,bindings:[]});let o=u.use(E[c].value),l=r=>o.set(r);return E[c].bindings.push(l),t[o.id].push(()=>{let r=o.get();E[c].bindings.filter(a=>a!==l).forEach(a=>a(r))}),{id:o.id,get:(...r)=>i?i(w(n[o.id],...r)):w(n[o.id],...r),set:o.set}},u.action=c=>({id:0,get:()=>c}),u.rootElement=e.host,u.element=e,C=s({$:u}),g(),{componentArgStore:f,componentStore:n,componentStoreBindings:t}};var N="1.0.1";typeof window<"u"&&(window._smolVersion=N);export{P as createComponent};
//# sourceMappingURL=index.js.map
